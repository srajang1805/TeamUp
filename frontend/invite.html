<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Invites - Team Up</title>
<style>
body { margin:0; font-family:"Segoe UI",sans-serif; background:#0d0d0d; color:#fff; overflow-x:hidden; }
header{background:rgba(20,20,30,0.95); padding:1rem; display:flex; justify-content:space-between;}
header h1{margin:0;background:linear-gradient(90deg,#ff66cc,#66a3ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
nav a{color:#ccc;text-decoration:none;margin-left:1rem;}
nav a:hover{color:#00e5ff;}
.container{max-width:900px;margin:2rem auto;padding:1rem;}
.tabs{display:flex;justify-content:center;gap:1rem;margin-bottom:1rem;}
.tab-btn{padding:0.5rem 1rem;border:none;border-radius:8px;cursor:pointer;background:rgba(255,255,255,0.05);color:#ccc;font-weight:bold;}
.tab-btn.active{background:#00e5ff;color:#000;}
.card{background:rgba(20,20,30,0.95);border-radius:12px;padding:1rem;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center;}
.btn{border:none;padding:0.5rem 1rem;border-radius:10px;cursor:pointer;margin-left:0.5rem;}
.btn-accept{background:#00ff99;color:#000;}
.btn-reject{background:#ff5252;color:#fff;}
</style>
</head>
<body>
<header>
  <h1>Invites</h1>
  <nav>
    <a href="dashboard.html">Home</a>
    <a href="team.html">Teams</a>
    <a href="chat.html">Chats</a>
    <a href="invite.html">Invites</a>
    <a href="#" id="logoutBtn">Logout</a>
  </nav>
</header>
<div class="container">
  <div class="tabs">
    <button class="tab-btn active" id="pendingTab">Pending</button>
    <button class="tab-btn" id="sentTab">Sent</button>
  </div>
  <div id="inviteContainer"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs, doc, updateDoc, arrayUnion, arrayRemove, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = { 
  apiKey:"AIzaSyC78TbLZQWs9FdfQV9m5Crw7md_PdISaCg", 
  authDomain:"teamup-8a9f0.firebaseapp.com", 
  projectId:"teamup-8a9f0" 
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const container = document.getElementById("inviteContainer");
const pendingTab = document.getElementById("pendingTab");
const sentTab = document.getElementById("sentTab");
let currentUser = null;

onAuthStateChanged(auth, async user=>{
  if(!user) return window.location.href="login.html";
  currentUser = user;
  loadPendingInvites();
});

function clearContainer(){ container.innerHTML=""; }

async function getGroupName(groupId){
  const snap = await getDoc(doc(db,'groups',groupId));
  return snap.exists() ? snap.data().name : groupId;
}

// Load Pending Invites
async function loadPendingInvites(){
  clearContainer();
  pendingTab.classList.add("active"); sentTab.classList.remove("active");

  const q = query(collection(db,"groups"), where("requests","array-contains",currentUser.uid));
  const snap = await getDocs(q);
  if(snap.empty){ container.innerHTML="<p style='text-align:center;color:#ccc;'>No pending invites.</p>"; return; }

  for(const g of snap.docs){
    const group = g.data();
    const card = document.createElement("div"); card.className="card";
    card.innerHTML=`
      <div><strong>${group.name}</strong></div>
      <div>
        <button class="btn btn-accept" onclick="acceptInvite('${g.id}')">Accept</button>
        <button class="btn btn-reject" onclick="rejectInvite('${g.id}')">Reject</button>
      </div>`;
    container.appendChild(card);
  }
}

// Load Sent Invites
async function loadSentInvites(){
  clearContainer();
  pendingTab.classList.remove("active"); sentTab.classList.add("active");

  const q = query(collection(db,"groups"));
  const snap = await getDocs(q);
  for(const g of snap.docs){
    const group = g.data();
    if(group.creatorId===currentUser.uid && group.requests?.length){
      for(const uid of group.requests){
        const card = document.createElement("div"); card.className="card";
        card.innerHTML=`<div><strong>${group.name}</strong></div><div>Pending request to UID: ${uid}</div>`;
        container.appendChild(card);
      }
    }
  }
  if(container.innerHTML==="") container.innerHTML="<p style='text-align:center;color:#ccc;'>No sent invites.</p>";
}

// Accept Invite
window.acceptInvite = async (groupId) => {
  const groupRef = doc(db,"groups",groupId);
  await updateDoc(groupRef,{
    members: arrayUnion(currentUser.uid),
    requests: arrayRemove(currentUser.uid)
  });
  alert("Invite accepted! You are now a member.");
  loadPendingInvites();
};

// Reject Invite
window.rejectInvite = async (groupId) => {
  const groupRef = doc(db,"groups",groupId);
  await updateDoc(groupRef,{
    requests: arrayRemove(currentUser.uid)
  });
  alert("Invite rejected.");
  loadPendingInvites();
};

pendingTab.addEventListener("click", loadPendingInvites);
sentTab.addEventListener("click", loadSentInvites);

document.getElementById("logoutBtn").addEventListener("click", async e=>{
  e.preventDefault();
  await signOut(auth);
  window.location.href="login.html";
});
</script>
</body>
</html>
